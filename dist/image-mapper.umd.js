(function(G,ut){typeof exports=="object"&&typeof module<"u"?ut(exports):typeof define=="function"&&define.amd?define(["exports"],ut):(G=typeof globalThis<"u"?globalThis:G||self,ut(G["image-mapper"]={}))})(this,function(G){"use strict";const ut=window||void 0,q=ut.window.document,rt="http://www.w3.org/2000/svg",un="http://www.w3.org/1999/xlink",ye=new RegExp(/^data-[a-zA-Z]+/),Z=function(n,t,e){[n].flat().forEach(r=>{t.split(" ").forEach(i=>{r.addEventListener(i,e,{passive:!1})})})},hn=function(n,t,e){[n].flat().forEach(r=>{t.split(" ").forEach(i=>{r.removeEventListener(i,e)})})},cn={fill:"rgb(102, 102, 102)",stroke:"rgb(51, 51, 51)",cursor:"pointer"},ln={off:{"stroke-width":"1",opacity:.5},on:{"stroke-width":"2",opacity:.6}},fn={off:{"stroke-dasharray":"none","stroke-linejoin":"miter"},on:{"stroke-dasharray":"4 3","stroke-linejoin":"round"}},dn={fill:"rgb(255, 255, 255)",stroke:"rgb(51, 51, 51)","stroke-width":"1",opacity:.3,cursor:"pointer"},vn={opacity:.6},pn=()=>({component:Object.assign({},cn),componentHover:Object.assign({},ln),componentSelect:Object.assign({},fn),handle:Object.assign({},dn),handleHover:Object.assign({},vn)}),W=(n,t)=>Object.entries(t).forEach(([e,r])=>n.setAttribute(e,String(r))),Qt=(n,t,e)=>{Z(n,"mouseenter touchstart",()=>W(n,e)),Z(n,"mouseleave touchend touchleave",()=>W(n,t))};class X{constructor(t,e,r,i){this.x=t,this.y=e,this.moveHandler=r,this.element=q.createElementNS(rt,"circle"),this.element.setAttribute("cx",String(t)),this.element.setAttribute("cy",String(e)),this.element.setAttribute("r",String(5)),this.element.setAttribute("visibility","hidden"),this.isFrozen=i!==void 0?!!i:!1}freeze(t){return this.isFrozen=t!==void 0?!!t:!0,this.isFrozen&&this.setVisible(!1),this}setAttrX(t){return this.element.setAttribute("cx",String(t)),this}delete(){this.element.remove()}setAttrY(t){return this.element.setAttribute("cy",String(t)),this}move(t,e){return this.moveHandler(t,e),this}setVisible(t){return t=t!==void 0?!!t:!0,this.element.setAttribute("visibility",t?"visible":"hidden"),this}setStyle(t,e){return W(this.element,t),Qt(this.element,t,e),this}}/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var d=function(){return d=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},d.apply(this,arguments)};function Zt(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e}function E(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(u){o={error:u}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(o)throw o.error}}return s}function P(n,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return n.concat(s||Array.prototype.slice.call(t))}var C;(function(n){n.Start="xstate.start",n.Stop="xstate.stop",n.Raise="xstate.raise",n.Send="xstate.send",n.Cancel="xstate.cancel",n.NullEvent="",n.Assign="xstate.assign",n.After="xstate.after",n.DoneState="done.state",n.DoneInvoke="done.invoke",n.Log="xstate.log",n.Init="xstate.init",n.Invoke="xstate.invoke",n.ErrorExecution="error.execution",n.ErrorCommunication="error.communication",n.ErrorPlatform="error.platform",n.ErrorCustom="xstate.error",n.Update="xstate.update",n.Pure="xstate.pure",n.Choose="xstate.choose"})(C||(C={}));var tt;(function(n){n.Parent="#_parent",n.Internal="#_internal"})(tt||(tt={}));var It=C.Start,jt=C.Stop,ht=C.Raise,bt=C.Send,te=C.Cancel,ge=C.NullEvent,Rt=C.Assign,yn=C.After,gn=C.DoneState,Lt=C.Log,me=C.Init,kt=C.Invoke,mn=C.ErrorExecution,ee=C.ErrorPlatform,ne=C.ErrorCustom,Yt=C.Update,we=C.Choose,Se=C.Pure;const wn=Object.freeze(Object.defineProperty({__proto__:null,after:yn,assign:Rt,cancel:te,choose:we,doneState:gn,error:ne,errorExecution:mn,errorPlatform:ee,init:me,invoke:kt,log:Lt,nullEvent:ge,pure:Se,raise:ht,send:bt,start:It,stop:jt,update:Yt},Symbol.toStringTag,{value:"Module"}));var be=".",xe={},re="xstate.guard",Sn="",L=process.env.NODE_ENV==="production",zt;function ie(n,t,e){e===void 0&&(e=be);var r=xt(n,e),i=xt(t,e);return D(i)?D(r)?i===r:!1:D(r)?r in i:Object.keys(r).every(function(s){return s in i?ie(r[s],i[s]):!1})}function Ee(n){try{return D(n)||typeof n=="number"?"".concat(n):n.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function se(n,t){try{return ct(n)?n:n.toString().split(t)}catch{throw new Error("'".concat(n,"' is not a valid state path."))}}function bn(n){return typeof n=="object"&&"value"in n&&"context"in n&&"event"in n&&"_event"in n}function xt(n,t){if(bn(n))return n.value;if(ct(n))return Ft(n);if(typeof n!="string")return n;var e=se(n,t);return Ft(e)}function Ft(n){if(n.length===1)return n[0];for(var t={},e=t,r=0;r<n.length-1;r++)r===n.length-2?e[n[r]]=n[r+1]:(e[n[r]]={},e=e[n[r]]);return t}function Et(n,t){for(var e={},r=Object.keys(n),i=0;i<r.length;i++){var s=r[i];e[s]=t(n[s],s,n,i)}return e}function Oe(n,t,e){var r,i,s={};try{for(var o=E(Object.keys(n)),u=o.next();!u.done;u=o.next()){var a=u.value,h=n[a];e(h)&&(s[a]=t(h,a,n))}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}var xn=function(n){return function(t){var e,r,i=t;try{for(var s=E(n),o=s.next();!o.done;o=s.next()){var u=o.value;i=i[u]}}catch(a){e={error:a}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return i}};function En(n,t){return function(e){var r,i,s=e;try{for(var o=E(n),u=o.next();!u.done;u=o.next()){var a=u.value;s=s[t][a]}}catch(h){r={error:h}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}}function Ht(n){if(!n)return[[]];if(D(n))return[[n]];var t=R(Object.keys(n).map(function(e){var r=n[e];return typeof r!="string"&&(!r||!Object.keys(r).length)?[[e]]:Ht(n[e]).map(function(i){return[e].concat(i)})}));return t}function R(n){var t;return(t=[]).concat.apply(t,P([],A(n),!1))}function Ae(n){return ct(n)?n:[n]}function $(n){return n===void 0?[]:Ae(n)}function Ut(n,t,e){var r,i;if(M(n))return n(t,e.data);var s={};try{for(var o=E(Object.keys(n)),u=o.next();!u.done;u=o.next()){var a=u.value,h=n[a];M(h)?s[a]=h(t,e.data):s[a]=h}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function On(n){return/^(done|error)\./.test(n)}function Me(n){return!!(n instanceof Promise||n!==null&&(M(n)||typeof n=="object")&&M(n.then))}function An(n){return n!==null&&typeof n=="object"&&"transition"in n&&typeof n.transition=="function"}function Mn(n,t){var e,r,i=A([[],[]],2),s=i[0],o=i[1];try{for(var u=E(n),a=u.next();!a.done;a=u.next()){var h=a.value;t(h)?s.push(h):o.push(h)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return[s,o]}function De(n,t){return Et(n.states,function(e,r){if(e){var i=(D(t)?void 0:t[r])||(e?e.current:void 0);if(i)return{current:i,states:De(e,i)}}})}function Dn(n,t){return{current:t,states:De(n,t)}}function _e(n,t,e,r){L||F(!!n,"Attempting to update undefined context");var i=n&&e.reduce(function(s,o){var u,a,h=o.assignment,c={state:r,action:o,_event:t},f={};if(M(h))f=h(s,t.data,c);else try{for(var l=E(Object.keys(h)),v=l.next();!v.done;v=l.next()){var y=v.value,p=h[y];f[y]=M(p)?p(s,t.data,c):p}}catch(S){u={error:S}}finally{try{v&&!v.done&&(a=l.return)&&a.call(l)}finally{if(u)throw u.error}}return Object.assign({},s,f)},n);return i}var F=function(){};L||(F=function(n,t){var e=n instanceof Error?n:void 0;if(!(!e&&n)&&console!==void 0){var r=["Warning: ".concat(t)];e&&r.push(e),console.warn.apply(console,r)}});function ct(n){return Array.isArray(n)}function M(n){return typeof n=="function"}function D(n){return typeof n=="string"}function Ce(n,t){if(n)return D(n)?{type:re,name:n,predicate:t?t[n]:void 0}:M(n)?{type:re,name:n.name,predicate:n}:n}function _n(n){try{return"subscribe"in n&&M(n.subscribe)}catch{return!1}}var et=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();zt={},zt[et]=function(){return this},zt[Symbol.observable]=function(){return this};function it(n){return!!n&&"__xstatenode"in n}function Cn(n){return!!n&&typeof n.send=="function"}function Wt(n,t){return D(n)||typeof n=="number"?d({type:n},t):n}function H(n,t){if(!D(n)&&"$$type"in n&&n.$$type==="scxml")return n;var e=Wt(n);return d({name:e.type,data:e,$$type:"scxml",type:"external"},t)}function lt(n,t){var e=Ae(t).map(function(r){return typeof r>"u"||typeof r=="string"||it(r)?{target:r,event:n}:d(d({},r),{event:n})});return e}function Nn(n){if(!(n===void 0||n===Sn))return $(n)}function Tn(n,t,e){if(!L){var r=n.stack?" Stacktrace was '".concat(n.stack,"'"):"";if(n===t)console.error("Missing onError handler for invocation '".concat(e,"', error was '").concat(n,"'.").concat(r));else{var i=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(e,"'. ")+"Original error: '".concat(n,"'. ").concat(r," Current error is '").concat(t,"'.").concat(i))}}}function Ne(n,t,e,r,i){var s=n.options.guards,o={state:i,cond:t,_event:r};if(t.type===re)return((s==null?void 0:s[t.name])||t.predicate)(e,r.data,o);var u=s==null?void 0:s[t.type];if(!u)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(n.id,"'."));return u(e,r.data,o)}function Te(n){return typeof n=="string"?{type:n}:n}function Xt(n,t,e){var r=function(){},i=typeof n=="object",s=i?n:null;return{next:((i?n.next:n)||r).bind(s),error:((i?n.error:t)||r).bind(s),complete:((i?n.complete:e)||r).bind(s)}}function $t(n,t){return"".concat(n,":invocation[").concat(t,"]")}function oe(n){return(n.type===ht||n.type===bt&&n.to===tt.Internal)&&typeof n.delay!="number"}var st=H({type:me});function Vt(n,t){return t&&t[n]||void 0}function ft(n,t){var e;if(D(n)||typeof n=="number"){var r=Vt(n,t);M(r)?e={type:n,exec:r}:r?e=r:e={type:n,exec:void 0}}else if(M(n))e={type:n.name||n.toString(),exec:n};else{var r=Vt(n.type,t);if(M(r))e=d(d({},n),{exec:r});else if(r){var i=r.type||n.type;e=d(d(d({},r),n),{type:i})}else e=n}return e}var Q=function(n,t){if(!n)return[];var e=ct(n)?n:[n];return e.map(function(r){return ft(r,t)})};function Bt(n){var t=ft(n);return d(d({id:D(n)?n:t.id},t),{type:t.type})}function Pe(n,t){return{type:ht,event:typeof n=="function"?n:Wt(n),delay:t?t.delay:void 0,id:t==null?void 0:t.id}}function Ie(n,t,e,r){var i={_event:e},s=H(M(n.event)?n.event(t,e.data,i):n.event),o;if(D(n.delay)){var u=r&&r[n.delay];o=M(u)?u(t,e.data,i):u}else o=M(n.delay)?n.delay(t,e.data,i):n.delay;return d(d({},n),{type:ht,_event:s,delay:o})}function ot(n,t){return{to:t?t.to:void 0,type:bt,event:M(n)?n:Wt(n),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:M(n)?n.name:Ee(n)}}function je(n,t,e,r){var i={_event:e},s=H(M(n.event)?n.event(t,e.data,i):n.event),o;if(D(n.delay)){var u=r&&r[n.delay];o=M(u)?u(t,e.data,i):u}else o=M(n.delay)?n.delay(t,e.data,i):n.delay;var a=M(n.to)?n.to(t,e.data,i):n.to;return d(d({},n),{to:a,_event:s,event:s.data,delay:o})}function ae(n,t){return ot(n,d(d({},t),{to:tt.Parent}))}function Pn(n,t,e){return ot(t,d(d({},e),{to:n}))}function In(){return ae(Yt)}function jn(n,t){return ot(n,d(d({},t),{to:function(e,r,i){var s=i._event;return s.origin}}))}var Rn=function(n,t){return{context:n,event:t}};function Ln(n,t){return n===void 0&&(n=Rn),{type:Lt,label:t,expr:n}}var Re=function(n,t,e){return d(d({},n),{value:D(n.expr)?n.expr:n.expr(t,e.data,{_event:e})})},Le=function(n){return{type:te,sendId:n}};function ke(n){var t=Bt(n);return{type:C.Start,activity:t,exec:void 0}}function Ye(n){var t=M(n)?n:Bt(n);return{type:C.Stop,activity:t,exec:void 0}}function ze(n,t,e){var r=M(n.activity)?n.activity(t,e.data):n.activity,i=typeof r=="string"?{id:r}:r,s={type:C.Stop,activity:i};return s}var Fe=function(n){return{type:Rt,assignment:n}};function kn(n){return typeof n=="object"&&"type"in n}function He(n,t){var e=t?"#".concat(t):"";return"".concat(C.After,"(").concat(n,")").concat(e)}function Ot(n,t){var e="".concat(C.DoneState,".").concat(n),r={type:e,data:t};return r.toString=function(){return e},r}function At(n,t){var e="".concat(C.DoneInvoke,".").concat(n),r={type:e,data:t};return r.toString=function(){return e},r}function dt(n,t){var e="".concat(C.ErrorPlatform,".").concat(n),r={type:e,data:t};return r.toString=function(){return e},r}function Yn(n){return{type:C.Pure,get:n}}function zn(n,t){if(!L&&(!n||typeof n=="function")){var e=n;n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=typeof e=="function"?e.apply(void 0,P([],A(r),!1)):e;if(!s)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return s}}return ot(function(r,i){return i},d(d({},t),{to:n}))}function Fn(n,t){return ae(function(e,r,i){return{type:ne,data:M(n)?n(e,r,i):n}},d(d({},t),{to:tt.Parent}))}function Hn(n){return{type:C.Choose,conds:n}}var Un=function(n){var t,e,r=[];try{for(var i=E(n),s=i.next();!s.done;s=i.next())for(var o=s.value,u=0;u<o.actions.length;){if(o.actions[u].type===Rt){r.push(o.actions[u]),o.actions.splice(u,1);continue}u++}}catch(a){t={error:a}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return r};function Mt(n,t,e,r,i,s,o){o===void 0&&(o=!1);var u=o?[]:Un(i),a=u.length?_e(e,r,u,t):e,h=o?[e]:void 0,c=[];function f(y,p){var S;switch(p.type){case ht:{var m=Ie(p,a,r,n.options.delays);return s&&typeof m.delay=="number"&&s(m,a,r),m}case bt:var g=je(p,a,r,n.options.delays);if(!L){var w=p.delay;F(!D(w)||typeof g.delay=="number","No delay reference for delay expression '".concat(w,"' was found on machine '").concat(n.id,"'"))}return s&&g.to!==tt.Internal&&(y==="entry"?c.push(g):s(g,a,r)),g;case Lt:{var b=Re(p,a,r);return s==null||s(b,a,r),b}case we:{var I=p,N=(S=I.conds.find(function(at){var nt=Ce(at.cond,n.options.guards);return!nt||Ne(n,nt,a,r,s?void 0:t)}))===null||S===void 0?void 0:S.actions;if(!N)return[];var _=A(Mt(n,t,a,r,[{type:y,actions:Q($(N),n.options.actions)}],s,o),2),T=_[0],O=_[1];return a=O,h==null||h.push(a),T}case Se:{var N=p.get(a,r.data);if(!N)return[];var k=A(Mt(n,t,a,r,[{type:y,actions:Q($(N),n.options.actions)}],s,o),2),x=k[0],j=k[1];return a=j,h==null||h.push(a),x}case jt:{var b=ze(p,a,r);return s==null||s(b,e,r),b}case Rt:{a=_e(a,r,[p],s?void 0:t),h==null||h.push(a);break}default:var z=ft(p,n.options.actions),U=z.exec;if(s)s(z,a,r);else if(U&&h){var Pt=h.length-1,pe=d(d({},z),{exec:function(at){for(var nt=[],V=1;V<arguments.length;V++)nt[V-1]=arguments[V];U.apply(void 0,P([h[Pt]],A(nt),!1))}});z=pe}return z}}function l(y){var p,S,m=[];try{for(var g=E(y.actions),w=g.next();!w.done;w=g.next()){var b=w.value,I=f(y.type,b);I&&(m=m.concat(I))}}catch(N){p={error:N}}finally{try{w&&!w.done&&(S=g.return)&&S.call(g)}finally{if(p)throw p.error}}return c.forEach(function(N){s(N,a,r)}),c.length=0,m}var v=R(i.map(l));return[v,a]}const Wn=Object.freeze(Object.defineProperty({__proto__:null,actionTypes:wn,after:He,assign:Fe,cancel:Le,choose:Hn,done:Ot,doneInvoke:At,error:dt,escalate:Fn,forwardTo:zn,getActionFunction:Vt,initEvent:st,isActionObject:kn,log:Ln,pure:Yn,raise:Pe,resolveActions:Mt,resolveLog:Re,resolveRaise:Ie,resolveSend:je,resolveStop:ze,respond:jn,send:ot,sendParent:ae,sendTo:Pn,sendUpdate:In,start:ke,stop:Ye,toActionObject:ft,toActionObjects:Q,toActivityDefinition:Bt},Symbol.toStringTag,{value:"Module"}));var Ue=[],vt=function(n,t){Ue.push(n);var e=t(n);return Ue.pop(),e};function We(n){var t;return t={id:n,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:n}}},t[et]=function(){return this},t}function Xn(n,t,e,r){var i,s=Te(n.src),o=(i=t==null?void 0:t.options.services)===null||i===void 0?void 0:i[s.type],u=n.data?Ut(n.data,e,r):void 0,a=o?Xe(o,n.id,u):We(n.id);return a.meta=n,a}function Xe(n,t,e){var r=We(t);if(r.deferred=!0,it(n)){var i=r.state=vt(void 0,function(){return(e?n.withContext(e):n).initialState});r.getSnapshot=function(){return i}}return r}function $n(n){try{return typeof n.send=="function"}catch{return!1}}function Vn(n){return $n(n)&&"id"in n}function Bn(n){var t;return d((t={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},t[et]=function(){return this},t),n)}var Kt=function(n){return n.type==="atomic"||n.type==="final"};function $e(n){return Object.keys(n.states).map(function(t){return n.states[t]})}function Dt(n){return $e(n).filter(function(t){return t.type!=="history"})}function Ve(n){var t=[n];return Kt(n)?t:t.concat(R(Dt(n).map(Ve)))}function _t(n,t){var e,r,i,s,o,u,a,h,c=new Set(n),f=ue(c),l=new Set(t);try{for(var v=E(l),y=v.next();!y.done;y=v.next())for(var p=y.value,S=p.parent;S&&!l.has(S);)l.add(S),S=S.parent}catch(O){e={error:O}}finally{try{y&&!y.done&&(r=v.return)&&r.call(v)}finally{if(e)throw e.error}}var m=ue(l);try{for(var g=E(l),w=g.next();!w.done;w=g.next()){var p=w.value;if(p.type==="compound"&&(!m.get(p)||!m.get(p).length))f.get(p)?f.get(p).forEach(function(k){return l.add(k)}):p.initialStateNodes.forEach(function(k){return l.add(k)});else if(p.type==="parallel")try{for(var b=(o=void 0,E(Dt(p))),I=b.next();!I.done;I=b.next()){var N=I.value;l.has(N)||(l.add(N),f.get(N)?f.get(N).forEach(function(k){return l.add(k)}):N.initialStateNodes.forEach(function(k){return l.add(k)}))}}catch(k){o={error:k}}finally{try{I&&!I.done&&(u=b.return)&&u.call(b)}finally{if(o)throw o.error}}}}catch(O){i={error:O}}finally{try{w&&!w.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}try{for(var _=E(l),T=_.next();!T.done;T=_.next())for(var p=T.value,S=p.parent;S&&!l.has(S);)l.add(S),S=S.parent}catch(O){a={error:O}}finally{try{T&&!T.done&&(h=_.return)&&h.call(_)}finally{if(a)throw a.error}}return l}function Be(n,t){var e=t.get(n);if(!e)return{};if(n.type==="compound"){var r=e[0];if(r){if(Kt(r))return r.key}else return{}}var i={};return e.forEach(function(s){i[s.key]=Be(s,t)}),i}function ue(n){var t,e,r=new Map;try{for(var i=E(n),s=i.next();!s.done;s=i.next()){var o=s.value;r.has(o)||r.set(o,[]),o.parent&&(r.has(o.parent)||r.set(o.parent,[]),r.get(o.parent).push(o))}}catch(u){t={error:u}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return r}function Kn(n,t){var e=_t([n],t);return Be(n,ue(e))}function Ct(n,t){return Array.isArray(n)?n.some(function(e){return e===t}):n instanceof Set?n.has(t):!1}function Jn(n){return P([],A(new Set(R(P([],A(n.map(function(t){return t.ownEvents})),!1)))),!1)}function Jt(n,t){return t.type==="compound"?Dt(t).some(function(e){return e.type==="final"&&Ct(n,e)}):t.type==="parallel"?Dt(t).every(function(e){return Jt(n,e)}):!1}function Gn(n){return n===void 0&&(n=[]),n.reduce(function(t,e){return e.meta!==void 0&&(t[e.id]=e.meta),t},{})}function Ke(n){return new Set(R(n.map(function(t){return t.tags})))}function Je(n,t){if(n===t)return!0;if(n===void 0||t===void 0)return!1;if(D(n)||D(t))return n===t;var e=Object.keys(n),r=Object.keys(t);return e.length===r.length&&e.every(function(i){return Je(n[i],t[i])})}function qn(n){return typeof n!="object"||n===null?!1:"value"in n&&"_event"in n}function Qn(n,t){var e=n.exec,r=d(d({},n),{exec:e!==void 0?function(){return e(t.context,t.event,{action:n,state:t,_event:t._event})}:void 0});return r}var J=function(){function n(t){var e=this,r;this.actions=[],this.activities=xe,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||xe,this.meta=Gn(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(r=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&r!==void 0?r:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Jn(e.configuration)}})}return n.from=function(t,e){if(t instanceof n)return t.context!==e?new n({value:t.value,context:e,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var r=st;return new n({value:t,context:e,_event:r,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},n.create=function(t){return new n(t)},n.inert=function(t,e){if(t instanceof n){if(!t.actions.length)return t;var r=st;return new n({value:t.value,context:e,_event:r,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return n.from(t,e)},n.prototype.toStrings=function(t,e){var r=this;if(t===void 0&&(t=this.value),e===void 0&&(e="."),D(t))return[t];var i=Object.keys(t);return i.concat.apply(i,P([],A(i.map(function(s){return r.toStrings(t[s],e).map(function(o){return s+e+o})})),!1))},n.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var e=t.tags;t.machine;var r=Zt(t,["configuration","transitions","tags","machine"]);return d(d({},r),{tags:Array.from(e)})},n.prototype.matches=function(t){return ie(t,this.value)},n.prototype.hasTag=function(t){return this.tags.has(t)},n.prototype.can=function(t){var e;L&&F(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var r=(e=this.machine)===null||e===void 0?void 0:e.getTransitionData(this,t);return!!(r!=null&&r.transitions.length)&&r.transitions.some(function(i){return i.target!==void 0||i.actions.length})},n}(),Zn={deferEvents:!1},Ge=function(){function n(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=d(d({},Zn),t)}return n.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents){this.schedule(t);return}this.process(t)}this.flushEvents()},n.prototype.schedule=function(t){if(!this.initialized||this.processingEvent){this.queue.push(t);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()},n.prototype.clear=function(){this.queue=[]},n.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},n.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(e){throw this.clear(),e}finally{this.processingEvent=!1}},n}(),he=new Map,tr=0,Nt={bookId:function(){return"x:".concat(tr++)},register:function(n,t){return he.set(n,t),n},get:function(n){return he.get(n)},free:function(n){he.delete(n)}};function ce(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;L||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues")}function er(){var n=ce();if(n&&"__xstate__"in n)return n.__xstate__}function nr(n){if(ce()){var t=er();t&&t.register(n)}}function rr(n,t){t===void 0&&(t={});var e=n.initialState,r=new Set,i=[],s=!1,o=function(){if(!s){for(s=!0;i.length>0;){var h=i.shift();e=n.transition(e,h,a),r.forEach(function(c){return c.next(e)})}s=!1}},u=Bn({id:t.id,send:function(h){i.push(h),o()},getSnapshot:function(){return e},subscribe:function(h,c,f){var l=Xt(h,c,f);return r.add(l),l.next(e),{unsubscribe:function(){r.delete(l)}}}}),a={parent:t.parent,self:u,id:t.id||"anonymous",observers:r};return e=n.start?n.start(a):e,u}var ir={sync:!1,autoForward:!1},Y;(function(n){n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped"})(Y||(Y={}));var sr=function(){function n(t,e){e===void 0&&(e=n.defaultOptions);var r=this;this.machine=t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=Y.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(c,f){if(ct(c))return r.batch(c),r.state;var l=H(Wt(c,f));if(r.status===Y.Stopped)return L||F(!1,'Event "'.concat(l.name,'" was sent to stopped service "').concat(r.machine.id,`". This service has already reached its final state, and will not transition.
Event: `).concat(JSON.stringify(l.data))),r.state;if(r.status!==Y.Running&&!r.options.deferEvents)throw new Error('Event "'.concat(l.name,'" was sent to uninitialized service "').concat(r.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(l.data)));return r.scheduler.schedule(function(){r.forward(l);var v=r._nextState(l);r.update(v,l)}),r._state},this.sendTo=function(c,f,l){var v=r.parent&&(f===tt.Parent||r.parent.id===f),y=v?r.parent:D(f)?f===tt.Internal?r:r.children.get(f)||Nt.get(f):Cn(f)?f:void 0;if(!y){if(!v)throw new Error("Unable to send event to child '".concat(f,"' from service '").concat(r.id,"'."));L||F(!1,"Service '".concat(r.id,"' has no parent: unable to send event ").concat(c.type));return}if("machine"in y){if(r.status!==Y.Stopped||r.parent!==y||r.state.done){var p=d(d({},c),{name:c.name===ne?"".concat(dt(r.id)):c.name,origin:r.sessionId});!l&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([y,p]):y.send(p)}}else!l&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([y,c.data]):y.send(c.data)},this._exec=function(c,f,l,v){v===void 0&&(v=r.machine.options.actions);var y=c.exec||Vt(c.type,v),p=M(y)?y:y?y.exec:c.exec;if(p)try{return p(f,l.data,r.machine.config.predictableActionArguments?{action:c,_event:l}:{action:c,state:r.state,_event:l})}catch(U){throw r.parent&&r.parent.send({type:"xstate.error",data:U}),U}switch(c.type){case ht:{var S=c;r.defer(S);break}case bt:var m=c;if(typeof m.delay=="number"){r.defer(m);return}else m.to?r.sendTo(m._event,m.to,l===st):r.send(m._event);break;case te:r.cancel(c.sendId);break;case It:{if(r.status!==Y.Running)return;var g=c.activity;if(!r.machine.config.predictableActionArguments&&!r.state.activities[g.id||g.type])break;if(g.type===C.Invoke){var w=Te(g.src),b=r.machine.options.services?r.machine.options.services[w.type]:void 0,I=g.id,N=g.data;L||F(!("forward"in g),"`forward` property is deprecated (found in invocation of '".concat(g.src,"' in in machine '").concat(r.machine.id,"'). ")+"Please use `autoForward` instead.");var _="autoForward"in g?g.autoForward:!!g.forward;if(!b){L||F(!1,"No service found for invocation '".concat(g.src,"' in machine '").concat(r.machine.id,"'."));return}var T=N?Ut(N,f,l):void 0;if(typeof b=="string")return;var O=M(b)?b(f,l.data,{data:T,src:w,meta:g.meta}):b;if(!O)return;var k=void 0;it(O)&&(O=T?O.withContext(T):O,k={autoForward:_}),r.spawn(O,I,k)}else r.spawnActivity(g);break}case jt:{r.stopChild(c.activity.id);break}case Lt:var x=c,j=x.label,z=x.value;j?r.logger(j,z):r.logger(z);break;default:L||F(!1,"No implementation found for action type '".concat(c.type,"'"));break}};var i=d(d({},n.defaultOptions),e),s=i.clock,o=i.logger,u=i.parent,a=i.id,h=a!==void 0?a:t.id;this.id=h,this.logger=o,this.clock=s,this.parent=u,this.options=i,this.scheduler=new Ge({deferEvents:this.options.deferEvents}),this.sessionId=Nt.bookId()}return Object.defineProperty(n.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:vt(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return L||F(this.status!==Y.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),n.prototype.execute=function(t,e){var r,i;try{for(var s=E(t.actions),o=s.next();!o.done;o=s.next()){var u=o.value;this.exec(u,t,e)}}catch(a){r={error:a}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},n.prototype.update=function(t,e){var r,i,s,o,u,a,h,c,f=this;if(t._sessionid=this.sessionId,this._state=t,(!this.machine.config.predictableActionArguments||e===st)&&this.options.execute)this.execute(this.state);else for(var l=void 0;l=this._outgoingQueue.shift();)l[0].send(l[1]);if(this.children.forEach(function(O){f.state.children[O.id]=O}),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var v=E(this.eventListeners),y=v.next();!y.done;y=v.next()){var p=y.value;p(t.event)}}catch(O){r={error:O}}finally{try{y&&!y.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}try{for(var S=E(this.listeners),m=S.next();!m.done;m=S.next()){var p=m.value;p(t,t.event)}}catch(O){s={error:O}}finally{try{m&&!m.done&&(o=S.return)&&o.call(S)}finally{if(s)throw s.error}}try{for(var g=E(this.contextListeners),w=g.next();!w.done;w=g.next()){var b=w.value;b(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(O){u={error:O}}finally{try{w&&!w.done&&(a=g.return)&&a.call(g)}finally{if(u)throw u.error}}if(this.state.done){var I=t.configuration.find(function(O){return O.type==="final"&&O.parent===f.machine}),N=I&&I.doneData?Ut(I.doneData,t.context,e):void 0;this._doneEvent=At(this.id,N);try{for(var _=E(this.doneListeners),T=_.next();!T.done;T=_.next()){var p=T.value;p(this._doneEvent)}}catch(O){h={error:O}}finally{try{T&&!T.done&&(c=_.return)&&c.call(_)}finally{if(h)throw h.error}}this._stop(),this._stopChildren(),Nt.free(this.sessionId)}},n.prototype.onTransition=function(t){return this.listeners.add(t),this.status===Y.Running&&t(this.state,this.state.event),this},n.prototype.subscribe=function(t,e,r){var i=this,s=Xt(t,e,r);this.listeners.add(s.next),this.status!==Y.NotStarted&&s.next(this.state);var o=function(){i.doneListeners.delete(o),i.stopListeners.delete(o),s.complete()};return this.status===Y.Stopped?s.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:function(){i.listeners.delete(s.next),i.doneListeners.delete(o),i.stopListeners.delete(o)}}},n.prototype.onEvent=function(t){return this.eventListeners.add(t),this},n.prototype.onSend=function(t){return this.sendListeners.add(t),this},n.prototype.onChange=function(t){return this.contextListeners.add(t),this},n.prototype.onStop=function(t){return this.stopListeners.add(t),this},n.prototype.onDone=function(t){return this.status===Y.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this},n.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},n.prototype.start=function(t){var e=this;if(this.status===Y.Running)return this;this.machine._init(),Nt.register(this.sessionId,this),this.initialized=!0,this.status=Y.Running;var r=t===void 0?this.initialState:vt(this,function(){return qn(t)?e.machine.resolveState(t):e.machine.resolveState(J.from(t,e.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){e.update(r,st)}),this},n.prototype._stopChildren=function(){this.children.forEach(function(t){M(t.stop)&&t.stop()}),this.children.clear()},n.prototype._stop=function(){var t,e,r,i,s,o,u,a,h,c;try{for(var f=E(this.listeners),l=f.next();!l.done;l=f.next()){var v=l.value;this.listeners.delete(v)}}catch(_){t={error:_}}finally{try{l&&!l.done&&(e=f.return)&&e.call(f)}finally{if(t)throw t.error}}try{for(var y=E(this.stopListeners),p=y.next();!p.done;p=y.next()){var v=p.value;v(),this.stopListeners.delete(v)}}catch(_){r={error:_}}finally{try{p&&!p.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}try{for(var S=E(this.contextListeners),m=S.next();!m.done;m=S.next()){var v=m.value;this.contextListeners.delete(v)}}catch(_){s={error:_}}finally{try{m&&!m.done&&(o=S.return)&&o.call(S)}finally{if(s)throw s.error}}try{for(var g=E(this.doneListeners),w=g.next();!w.done;w=g.next()){var v=w.value;this.doneListeners.delete(v)}}catch(_){u={error:_}}finally{try{w&&!w.done&&(a=g.return)&&a.call(g)}finally{if(u)throw u.error}}if(!this.initialized)return this;this.initialized=!1,this.status=Y.Stopped,this._initialState=void 0;try{for(var b=E(Object.keys(this.delayedEventsMap)),I=b.next();!I.done;I=b.next()){var N=I.value;this.clock.clearTimeout(this.delayedEventsMap[N])}}catch(_){h={error:_}}finally{try{I&&!I.done&&(c=b.return)&&c.call(b)}finally{if(h)throw h.error}}this.scheduler.clear(),this.scheduler=new Ge({deferEvents:this.options.deferEvents})},n.prototype.stop=function(){var t=this,e=this.scheduler;return this._stop(),e.schedule(function(){var r;if(!(!((r=t._state)===null||r===void 0)&&r.done)){var i=H({type:"xstate.stop"}),s=vt(t,function(){var o=R(P([],A(t.state.configuration),!1).sort(function(f,l){return l.order-f.order}).map(function(f){return Q(f.onExit,t.machine.options.actions)})),u=A(Mt(t.machine,t.state,t.state.context,i,[{type:"exit",actions:o}],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),a=u[0],h=u[1],c=new J({value:t.state.value,context:h,_event:i,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:a.filter(function(f){return!oe(f)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return c.changed=!0,c});t.update(s,i),t._stopChildren(),Nt.free(t.sessionId)}}),this},n.prototype.batch=function(t){var e=this;if(this.status===Y.NotStarted&&this.options.deferEvents)L||F(!1,"".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,`" and are deferred. Make sure .start() is called for this service.
Event: `).concat(JSON.stringify(event)));else if(this.status!==Y.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(t.length){var r=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,s,o=e.state,u=!1,a=[],h=function(v){var y=H(v);e.forward(y),o=vt(e,function(){return e.machine.transition(o,y,void 0,r||void 0)}),a.push.apply(a,P([],A(e.machine.config.predictableActionArguments?o.actions:o.actions.map(function(p){return Qn(p,o)})),!1)),u=u||!!o.changed};try{for(var c=E(t),f=c.next();!f.done;f=c.next()){var l=f.value;h(l)}}catch(v){i={error:v}}finally{try{f&&!f.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}o.changed=u,o.actions=a,e.update(o,H(t[t.length-1]))})}},n.prototype.sender=function(t){return this.send.bind(this,t)},n.prototype._nextState=function(t,e){var r=this;e===void 0&&(e=!!this.machine.config.predictableActionArguments&&this._exec);var i=H(t);if(i.name.indexOf(ee)===0&&!this.state.nextEvents.some(function(o){return o.indexOf(ee)===0}))throw i.data.data;var s=vt(this,function(){return r.machine.transition(r.state,i,void 0,e||void 0)});return s},n.prototype.nextState=function(t){return this._nextState(t,!1)},n.prototype.forward=function(t){var e,r;try{for(var i=E(this.forwardTo),s=i.next();!s.done;s=i.next()){var o=s.value,u=this.children.get(o);if(!u)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));u.send(t)}}catch(a){e={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},n.prototype.defer=function(t){var e=this,r=this.clock.setTimeout(function(){"to"in t&&t.to?e.sendTo(t._event,t.to,!0):e.send(t._event)},t.delay);t.id&&(this.delayedEventsMap[t.id]=r)},n.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},n.prototype.exec=function(t,e,r){r===void 0&&(r=this.machine.options.actions),this._exec(t,e.context,e._event,r)},n.prototype.removeChild=function(t){var e;this.children.delete(t),this.forwardTo.delete(t),(e=this.state)===null||e===void 0||delete e.children[t]},n.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),M(e.stop)&&e.stop())},n.prototype.spawn=function(t,e,r){if(this.status!==Y.Running)return Xe(t,e);if(Me(t))return this.spawnPromise(Promise.resolve(t),e);if(M(t))return this.spawnCallback(t,e);if(Vn(t))return this.spawnActor(t,e);if(_n(t))return this.spawnObservable(t,e);if(it(t))return this.spawnMachine(t,d(d({},r),{id:e}));if(An(t))return this.spawnBehavior(t,e);throw new Error('Unable to spawn entity "'.concat(e,'" of type "').concat(typeof t,'".'))},n.prototype.spawnMachine=function(t,e){var r=this;e===void 0&&(e={});var i=new n(t,d(d({},this.options),{parent:this,id:e.id||t.id})),s=d(d({},ir),e);s.sync&&i.onTransition(function(u){r.send(Yt,{state:u,id:i.id})});var o=i;return this.children.set(i.id,o),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(u){r.removeChild(i.id),r.send(H(u,{origin:i.id}))}).start(),o},n.prototype.spawnBehavior=function(t,e){var r=rr(t,{id:e,parent:this});return this.children.set(e,r),r},n.prototype.spawnPromise=function(t,e){var r,i=this,s=!1,o;t.then(function(a){s||(o=a,i.removeChild(e),i.send(H(At(e,a),{origin:e})))},function(a){if(!s){i.removeChild(e);var h=dt(e,a);try{i.send(H(h,{origin:e}))}catch(c){Tn(a,c,e),i.devTools&&i.devTools.send(h,i.state),i.machine.strict&&i.stop()}}});var u=(r={id:e,send:function(){},subscribe:function(a,h,c){var f=Xt(a,h,c),l=!1;return t.then(function(v){l||(f.next(v),!l&&f.complete())},function(v){l||f.error(v)}),{unsubscribe:function(){return l=!0}}},stop:function(){s=!0},toJSON:function(){return{id:e}},getSnapshot:function(){return o}},r[et]=function(){return this},r);return this.children.set(e,u),u},n.prototype.spawnCallback=function(t,e){var r,i=this,s=!1,o=new Set,u=new Set,a,h=function(l){a=l,u.forEach(function(v){return v(l)}),!s&&i.send(H(l,{origin:e}))},c;try{c=t(h,function(l){o.add(l)})}catch(l){this.send(dt(e,l))}if(Me(c))return this.spawnPromise(c,e);var f=(r={id:e,send:function(l){return o.forEach(function(v){return v(l)})},subscribe:function(l){var v=Xt(l);return u.add(v.next),{unsubscribe:function(){u.delete(v.next)}}},stop:function(){s=!0,M(c)&&c()},toJSON:function(){return{id:e}},getSnapshot:function(){return a}},r[et]=function(){return this},r);return this.children.set(e,f),f},n.prototype.spawnObservable=function(t,e){var r,i=this,s,o=t.subscribe(function(a){s=a,i.send(H(a,{origin:e}))},function(a){i.removeChild(e),i.send(H(dt(e,a),{origin:e}))},function(){i.removeChild(e),i.send(H(At(e),{origin:e}))}),u=(r={id:e,send:function(){},subscribe:function(a,h,c){return t.subscribe(a,h,c)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return s},toJSON:function(){return{id:e}}},r[et]=function(){return this},r);return this.children.set(e,u),u},n.prototype.spawnActor=function(t,e){return this.children.set(e,t),t},n.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(!e){L||F(!1,"No implementation found for activity '".concat(t.type,"'"));return}var r=e(this.state.context,t);this.spawnEffect(t.id,r)},n.prototype.spawnEffect=function(t,e){var r;this.children.set(t,(r={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}},r[et]=function(){return this},r))},n.prototype.attachDev=function(){var t=ce();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(d(d({name:this.id,autoPause:!0,stateSanitizer:function(r){return{value:r.value,context:r.context,actions:r.actions}}},e),{features:d({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}nr(this)}},n.prototype.toJSON=function(){return{id:this.id}},n.prototype[et]=function(){return this},n.prototype.getSnapshot=function(){return this.status===Y.NotStarted?this.initialState:this._state},n.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,e){return setTimeout(t,e)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},n.interpret=qe,n}();function qe(n,t){var e=new sr(n,t);return e}function or(n){if(typeof n=="string"){var t={type:n};return t.toString=function(){return n},t}return n}function Gt(n){return d(d({type:kt},n),{toJSON:function(){n.onDone,n.onError;var t=Zt(n,["onDone","onError"]);return d(d({},t),{type:kt,src:or(n.src)})}})}var pt="",le="#",Tt="*",yt={},gt=function(n){return n[0]===le},ar=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},ur=function(n,t,e){var r=e.slice(0,-1).some(function(s){return!("cond"in s)&&!("in"in s)&&(D(s.target)||it(s.target))}),i=t===pt?"the transient event":"event '".concat(t,"'");F(!r,"One or more transitions for ".concat(i," on state '").concat(n.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},hr=function(){function n(t,e,r,i){r===void 0&&(r="context"in t?t.context:void 0);var s=this,o;this.config=t,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(ar(),e),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:be),this.id=this.config.id||P([this.machine.key],A(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,L||F(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?Et(this.config.states,function(h,c){var f,l=new n(h,{},void 0,{parent:s,key:c});return Object.assign(s.idMap,d((f={},f[l.id]=l,f),l.idMap)),l}):yt;var u=0;function a(h){var c,f;h.order=u++;try{for(var l=E($e(h)),v=l.next();!v.done;v=l.next()){var y=v.value;a(y)}}catch(p){c={error:p}}finally{try{v&&!v.done&&(f=l.return)&&f.call(l)}finally{if(c)throw c.error}}}a(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(h){var c=h.event;return c===pt}):pt in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=$(this.config.entry||this.config.onEntry).map(function(h){return ft(h)}),this.onExit=$(this.config.exit||this.config.onExit).map(function(h){return ft(h)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=$(this.config.invoke).map(function(h,c){var f,l;if(it(h)){var v=$t(s.id,c);return s.machine.options.services=d((f={},f[v]=h,f),s.machine.options.services),Gt({src:v,id:v})}else if(D(h.src)){var v=h.id||$t(s.id,c);return Gt(d(d({},h),{id:v,src:h.src}))}else if(it(h.src)||M(h.src)){var v=h.id||$t(s.id,c);return s.machine.options.services=d((l={},l[v]=h.src,l),s.machine.options.services),Gt(d(d({id:v},h),{src:v}))}else{var y=h.src;return Gt(d(d({id:$t(s.id,c)},h),{src:y}))}}),this.activities=$(this.config.activities).concat(this.invoke).map(function(h){return Bt(h)}),this.transition=this.transition.bind(this),this.tags=$(this.config.tags)}return n.prototype._init=function(){this.__cache.transitions||Ve(this).forEach(function(t){return t.on})},n.prototype.withConfig=function(t,e){var r=this.options,i=r.actions,s=r.activities,o=r.guards,u=r.services,a=r.delays;return new n(this.config,{actions:d(d({},i),t.actions),activities:d(d({},s),t.activities),guards:d(d({},o),t.guards),services:d(d({},u),t.services),delays:d(d({},a),t.delays)},e??this.context)},n.prototype.withContext=function(t){return new n(this.config,this.options,t)},Object.defineProperty(n.prototype,"context",{get:function(){return M(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Et(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return this.definition},Object.defineProperty(n.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(e,r){return e[r.eventType]=e[r.eventType]||[],e[r.eventType].push(r),e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),n.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=t===pt,r=this.transitions.filter(function(i){var s=i.eventType===t;return e?s:s||i.eventType===Tt});return this.__cache.candidates[t]=r,r},n.prototype.getDelayedTransitions=function(){var t=this,e=this.config.after;if(!e)return[];var r=function(s,o){var u=M(s)?"".concat(t.id,":delay[").concat(o,"]"):s,a=He(u,t.id);return t.onEntry.push(ot(a,{delay:s})),t.onExit.push(Le(a)),a},i=ct(e)?e.map(function(s,o){var u=r(s.delay,o);return d(d({},s),{event:u})}):R(Object.keys(e).map(function(s,o){var u=e[s],a=D(u)?{target:u}:u,h=isNaN(+s)?s:+s,c=r(h,o);return $(a).map(function(f){return d(d({},f),{event:c,delay:h})})}));return i.map(function(s){var o=s.delay;return d(d({},t.formatTransition(s)),{delay:o})})},n.prototype.getStateNodes=function(t){var e,r=this;if(!t)return[];var i=t instanceof J?t.value:xt(t,this.delimiter);if(D(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((e={},e[i]=s,e)):[this,this.states[i]]}var o=Object.keys(i),u=[this];return u.push.apply(u,P([],A(R(o.map(function(a){return r.getStateNode(a).getStateNodes(i[a])}))),!1)),u},n.prototype.handles=function(t){var e=Ee(t);return this.events.includes(e)},n.prototype.resolveState=function(t){var e=t instanceof J?t:J.create(t),r=Array.from(_t([],this.getStateNodes(e.value)));return new J(d(d({},e),{value:this.resolve(e.value),configuration:r,done:Jt(r,this),tags:Ke(r),machine:this.machine}))},n.prototype.transitionLeafNode=function(t,e,r){var i=this.getStateNode(t),s=i.next(e,r);return!s||!s.transitions.length?this.next(e,r):s},n.prototype.transitionCompoundNode=function(t,e,r){var i=Object.keys(t),s=this.getStateNode(i[0]),o=s._transition(t[i[0]],e,r);return!o||!o.transitions.length?this.next(e,r):o},n.prototype.transitionParallelNode=function(t,e,r){var i,s,o={};try{for(var u=E(Object.keys(t)),a=u.next();!a.done;a=u.next()){var h=a.value,c=t[h];if(c){var f=this.getStateNode(h),l=f._transition(c,e,r);l&&(o[h]=l)}}}catch(m){i={error:m}}finally{try{a&&!a.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}var v=Object.keys(o).map(function(m){return o[m]}),y=R(v.map(function(m){return m.transitions})),p=v.some(function(m){return m.transitions.length>0});if(!p)return this.next(e,r);var S=R(Object.keys(o).map(function(m){return o[m].configuration}));return{transitions:y,exitSet:R(v.map(function(m){return m.exitSet})),configuration:S,source:e,actions:R(Object.keys(o).map(function(m){return o[m].actions}))}},n.prototype._transition=function(t,e,r){return D(t)?this.transitionLeafNode(t,e,r):Object.keys(t).length===1?this.transitionCompoundNode(t,e,r):this.transitionParallelNode(t,e,r)},n.prototype.getTransitionData=function(t,e){return this._transition(t.value,t,H(e))},n.prototype.next=function(t,e){var r,i,s=this,o=e.name,u=[],a=[],h;try{for(var c=E(this.getCandidates(o)),f=c.next();!f.done;f=c.next()){var l=f.value,v=l.cond,y=l.in,p=t.context,S=y?D(y)&&gt(y)?t.matches(xt(this.getStateNodeById(y).path,this.delimiter)):ie(xt(y,this.delimiter),xn(this.path.slice(0,-2))(t.value)):!0,m=!1;try{m=!v||Ne(this.machine,v,p,e,t)}catch(b){throw new Error("Unable to evaluate guard '".concat(v.name||v.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(b.message))}if(m&&S){l.target!==void 0&&(a=l.target),u.push.apply(u,P([],A(l.actions),!1)),h=l;break}}}catch(b){r={error:b}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}if(h){if(!a.length)return{transitions:[h],exitSet:[],configuration:t.value?[this]:[],source:t,actions:u};var g=R(a.map(function(b){return s.getRelativeStateNodes(b,t.historyValue)})),w=!!h.internal;return{transitions:[h],exitSet:w?[]:R(a.map(function(b){return s.getPotentiallyReenteringNodes(b)})),configuration:g,source:t,actions:u}}},n.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var e=[],r=this,i=t;r&&r!==i;)e.push(r),r=r.parent;return r!==i?[]:(e.push(i),e)},n.prototype.getActions=function(t,e,r,i,s,o,u){var a,h,c,f,l=this,v=o?_t([],this.getStateNodes(o.value)):[],y=new Set;try{for(var p=E(Array.from(t).sort(function(x,j){return x.order-j.order})),S=p.next();!S.done;S=p.next()){var m=S.value;(!Ct(v,m)||Ct(r.exitSet,m)||m.parent&&y.has(m.parent))&&y.add(m)}}catch(x){a={error:x}}finally{try{S&&!S.done&&(h=p.return)&&h.call(p)}finally{if(a)throw a.error}}try{for(var g=E(v),w=g.next();!w.done;w=g.next()){var m=w.value;(!Ct(t,m)||Ct(r.exitSet,m.parent))&&r.exitSet.push(m)}}catch(x){c={error:x}}finally{try{w&&!w.done&&(f=g.return)&&f.call(g)}finally{if(c)throw c.error}}r.exitSet.sort(function(x,j){return j.order-x.order});var b=Array.from(y).sort(function(x,j){return x.order-j.order}),I=new Set(r.exitSet),N=R(b.map(function(x){var j=[];if(x.type!=="final")return j;var z=x.parent;if(!z.parent)return j;j.push(Ot(x.id,x.doneData),Ot(z.id,x.doneData?Ut(x.doneData,i,s):void 0));var U=z.parent;return U.type==="parallel"&&Dt(U).every(function(Pt){return Jt(r.configuration,Pt)})&&j.push(Ot(U.id)),j})),_=b.map(function(x){var j=x.onEntry,z=x.activities.map(function(U){return ke(U)});return{type:"entry",actions:Q(u?P(P([],A(j),!1),A(z),!1):P(P([],A(z),!1),A(j),!1),l.machine.options.actions)}}).concat({type:"state_done",actions:N.map(function(x){return Pe(x)})}),T=Array.from(I).map(function(x){return{type:"exit",actions:Q(P(P([],A(x.onExit),!1),A(x.activities.map(function(j){return Ye(j)})),!1),l.machine.options.actions)}}),O=T.concat({type:"transition",actions:Q(r.actions,this.machine.options.actions)}).concat(_);if(e){var k=Q(R(P([],A(t),!1).sort(function(x,j){return j.order-x.order}).map(function(x){return x.onExit})),this.machine.options.actions).filter(function(x){return!oe(x)});return O.concat({type:"stop",actions:k})}return O},n.prototype.transition=function(t,e,r,i){t===void 0&&(t=this.initialState);var s=H(e),o;if(t instanceof J)o=r===void 0?t:this.resolveState(J.from(t,r));else{var u=D(t)?this.resolve(Ft(this.getResolvedPath(t))):this.resolve(t),a=r??this.machine.context;o=this.resolveState(J.from(u,a))}if(!L&&s.name===Tt)throw new Error("An event cannot have the wildcard type ('".concat(Tt,"')"));if(this.strict&&!this.events.includes(s.name)&&!On(s.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(s.name,"'"));var h=this._transition(o.value,o,s)||{transitions:[],configuration:[],exitSet:[],source:o,actions:[]},c=_t([],this.getStateNodes(o.value)),f=h.configuration.length?_t(c,h.configuration):c;return h.configuration=P([],A(f),!1),this.resolveTransition(h,o,o.context,i,s)},n.prototype.resolveRaisedTransition=function(t,e,r,i){var s,o=t.actions;return t=this.transition(t,e,void 0,i),t._event=r,t.event=r.data,(s=t.actions).unshift.apply(s,P([],A(o),!1)),t},n.prototype.resolveTransition=function(t,e,r,i,s){var o,u,a,h,c=this;s===void 0&&(s=st);var f=t.configuration,l=!e||t.transitions.length>0,v=l?t.configuration:e?e.configuration:[],y=Jt(v,this),p=l?Kn(this.machine,f):void 0,S=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,m=this.getActions(new Set(v),y,t,r,s,e,i),g=e?d({},e.activities):{};try{for(var w=E(m),b=w.next();!b.done;b=w.next()){var I=b.value;try{for(var N=(a=void 0,E(I.actions)),_=N.next();!_.done;_=N.next()){var T=_.value;T.type===It?g[T.activity.id||T.activity.type]=T:T.type===jt&&(g[T.activity.id||T.activity.type]=!1)}}catch(K){a={error:K}}finally{try{_&&!_.done&&(h=N.return)&&h.call(N)}finally{if(a)throw a.error}}}}catch(K){o={error:K}}finally{try{b&&!b.done&&(u=w.return)&&u.call(w)}finally{if(o)throw o.error}}var O=A(Mt(this,e,r,s,m,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),k=O[0],x=O[1],j=A(Mn(k,oe),2),z=j[0],U=j[1],Pt=k.filter(function(K){var St;return K.type===It&&((St=K.activity)===null||St===void 0?void 0:St.type)===kt}),pe=Pt.reduce(function(K,St){return K[St.activity.id]=Xn(St.activity,c.machine,x,s),K},e?d({},e.children):{}),at=new J({value:p||e.value,context:x,_event:s,_sessionid:e?e._sessionid:null,historyValue:p?S?Dn(S,p):void 0:e?e.historyValue:void 0,history:!p||t.source?e:void 0,actions:p?U:[],activities:p?g:e?e.activities:{},events:[],configuration:v,transitions:t.transitions,children:pe,done:y,tags:Ke(v),machine:this}),nt=r!==x;at.changed=s.name===Yt||nt;var V=at.history;V&&delete V.history;var an=!y&&(this._transient||f.some(function(K){return K._transient}));if(!l&&(!an||s.name===pt))return at;var B=at;if(!y)for(an&&(B=this.resolveRaisedTransition(B,{type:ge},s,i));z.length;){var Or=z.shift();B=this.resolveRaisedTransition(B,Or._event,s,i)}var Ar=B.changed||(V?!!B.actions.length||nt||typeof V.value!=typeof B.value||!Je(B.value,V.value):void 0);return B.changed=Ar,B.history=V,B},n.prototype.getStateNode=function(t){if(gt(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var e=this.states[t];if(!e)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return e},n.prototype.getStateNodeById=function(t){var e=gt(t)?t.slice(le.length):t;if(e===this.id)return this;var r=this.machine.idMap[e];if(!r)throw new Error("Child state node '#".concat(e,"' does not exist on machine '").concat(this.id,"'"));return r},n.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&gt(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var e=se(t,this.delimiter).slice(),r=this;e.length;){var i=e.shift();if(!i.length)break;r=r.getStateNode(i)}return r},n.prototype.resolve=function(t){var e,r=this;if(!t)return this.initialStateValue||yt;switch(this.type){case"parallel":return Et(this.initialStateValue,function(s,o){return s?r.getStateNode(o).resolve(t[o]||s):yt});case"compound":if(D(t)){var i=this.getStateNode(t);return i.type==="parallel"||i.type==="compound"?(e={},e[t]=i.initialStateValue,e):t}return Object.keys(t).length?Et(t,function(s,o){return s?r.getStateNode(o).resolve(s):yt}):this.initialStateValue||{};default:return t||yt}},n.prototype.getResolvedPath=function(t){if(gt(t)){var e=this.machine.idMap[t.slice(le.length)];if(!e)throw new Error("Unable to find state node '".concat(t,"'"));return e.path}return se(t,this.delimiter)},Object.defineProperty(n.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var e;if(this.type==="parallel")e=Oe(this.states,function(r){return r.initialStateValue||yt},function(r){return r.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));e=Kt(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else e={};return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),n.prototype.getInitialState=function(t,e){this._init();var r=this.getStateNodes(t);return this.resolveTransition({configuration:r,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,e??this.machine.context,void 0)},Object.defineProperty(n.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"target",{get:function(){var t;if(this.type==="history"){var e=this.config;D(e.target)?t=gt(e.target)?Ft(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target:t=e.target}return t},enumerable:!1,configurable:!0}),n.prototype.getRelativeStateNodes=function(t,e,r){return r===void 0&&(r=!0),r?t.type==="history"?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(n.prototype,"initialStateNodes",{get:function(){var t=this;if(Kt(this))return[this];if(this.type==="compound"&&!this.initial)return L||F(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var e=Ht(this.initialStateValue);return R(e.map(function(r){return t.getFromRelativePath(r)}))},enumerable:!1,configurable:!0}),n.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=A(t),r=e[0],i=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var s=this.getStateNode(r);if(s.type==="history")return s.resolveHistory();if(!this.states[r])throw new Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(i)},n.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:Oe(this.states,function(e,r){if(!t)return e.historyValue();var i=D(t)?void 0:t[r];return e.historyValue(i||e.initialStateValue)},function(e){return!e.history})}},n.prototype.resolveHistory=function(t){var e=this;if(this.type!=="history")return[this];var r=this.parent;if(!t){var i=this.target;return i?R(Ht(i).map(function(o){return r.getFromRelativePath(o)})):r.initialStateNodes}var s=En(r.path,"states")(t).current;return D(s)?[r.getStateNode(s)]:R(Ht(s).map(function(o){return e.history==="deep"?r.getFromRelativePath(o):[r.states[o[0]]]}))},Object.defineProperty(n.prototype,"stateIds",{get:function(){var t=this,e=R(Object.keys(this.states).map(function(r){return t.states[r].stateIds}));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"events",{get:function(){var t,e,r,i;if(this.__cache.events)return this.__cache.events;var s=this.states,o=new Set(this.ownEvents);if(s)try{for(var u=E(Object.keys(s)),a=u.next();!a.done;a=u.next()){var h=a.value,c=s[h];if(c.states)try{for(var f=(r=void 0,E(c.events)),l=f.next();!l.done;l=f.next()){var v=l.value;o.add("".concat(v))}}catch(y){r={error:y}}finally{try{l&&!l.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}}catch(y){t={error:y}}finally{try{a&&!a.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(e){return!(!e.target&&!e.actions.length&&e.internal)}).map(function(e){return e.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),n.prototype.resolveTarget=function(t){var e=this;if(t!==void 0)return t.map(function(r){if(!D(r))return r;var i=r[0]===e.delimiter;if(i&&!e.parent)return e.getStateNodeByPath(r.slice(1));var s=i?e.key+r:r;if(e.parent)try{var o=e.parent.getStateNodeByPath(s);return o}catch(u){throw new Error("Invalid transition definition for state node '".concat(e.id,`':
`).concat(u.message))}else return e.getStateNodeByPath(s)})},n.prototype.formatTransition=function(t){var e=this,r=Nn(t.target),i="internal"in t?t.internal:r?r.some(function(a){return D(a)&&a[0]===e.delimiter}):!0,s=this.machine.options.guards,o=this.resolveTarget(r),u=d(d({},t),{actions:Q($(t.actions)),cond:Ce(t.cond,s),target:o,source:this,internal:i,eventType:t.event,toJSON:function(){return d(d({},u),{target:u.target?u.target.map(function(a){return"#".concat(a.id)}):void 0,source:"#".concat(e.id)})}});return u},n.prototype.formatTransitions=function(){var t,e,r=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,o=Tt,u=s[o],a=u===void 0?[]:u,h=Zt(s,[typeof o=="symbol"?o:o+""]);i=R(Object.keys(h).map(function(g){!L&&g===pt&&F(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(r.id,'".'));var w=lt(g,h[g]);return L||ur(r,g,w),w}).concat(lt(Tt,a)))}var c=this.config.always?lt("",this.config.always):[],f=this.config.onDone?lt(String(Ot(this.id)),this.config.onDone):[];L||F(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var l=R(this.invoke.map(function(g){var w=[];return g.onDone&&w.push.apply(w,P([],A(lt(String(At(g.id)),g.onDone)),!1)),g.onError&&w.push.apply(w,P([],A(lt(String(dt(g.id)),g.onError)),!1)),w})),v=this.after,y=R(P(P(P(P([],A(f),!1),A(l),!1),A(i),!1),A(c),!1).map(function(g){return $(g).map(function(w){return r.formatTransition(w)})}));try{for(var p=E(v),S=p.next();!S.done;S=p.next()){var m=S.value;y.push(m)}}catch(g){t={error:g}}finally{try{S&&!S.done&&(e=p.return)&&e.call(p)}finally{if(t)throw t.error}}return y},n}(),Qe=!1;function cr(n,t){return!L&&!("predictableActionArguments"in n)&&!Qe&&(Qe=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new hr(n,t)}var mt=Fe,fe=ot;const{choose:lr}=Wn,fr={rect:{on:{MT_DOWN:{actions:["createRectangle","selectUnfinished"],target:"#drawing.rect.mouseIsDown"}}},circle:{on:{MT_DOWN:{actions:["createCircle","selectUnfinished"],target:"#drawing.circle.mouseIsDown"}}},ellipse:{on:{MT_DOWN:{actions:["createEllipse","selectUnfinished"],target:"#drawing.ellipse.mouseIsDown"}}},polygon:{on:{MT_DOWN:{actions:["createPolygon","selectUnfinished"],target:"#drawing.polygon.mouseIsDown"}}}},dr={rect:{states:{mouseIsDown:{on:{MT_UP:"#idle.drawMode.rect",KEYDOWN_ESC:"#idle.drawMode.rect",MT_MOVE:{actions:"resizeUnfinished"}}}}},circle:{states:{mouseIsDown:{on:{MT_UP:"#idle.drawMode.circle",KEYDOWN_ESC:"#idle.drawMode.circle",MT_MOVE:{actions:"resizeUnfinished"}}}}},ellipse:{states:{mouseIsDown:{on:{MT_UP:"#idle.drawMode.ellipse",KEYDOWN_ESC:"#idle.drawMode.ellipse",MT_MOVE:{actions:"resizeUnfinished"}}}}},polygon:{on:{KEYDOWN_ESC:"#idle.drawMode.polygon"},states:{mouseIsDown:{on:{MT_UP:"mouseIsUp",MT_MOVE:{actions:"moveLastPoint"}}},mouseIsUp:{on:{MT_DOWN:[{cond:"isHandle",target:"#idle.drawMode.polygon"},{actions:"addPoint",target:"mouseIsDown"}]}}}}},vr=n=>cr({context:{unfinishedComponent:void 0,mouseDownInSelectModeObject:void 0,_editor:n},predictableActionArguments:!0,on:{MODE_SELECT:"idle.selectMode",MODE_DRAW_RECT:"idle.drawMode.rect",MODE_DRAW_CIRCLE:"idle.drawMode.circle",MODE_DRAW_ELLIPSE:"idle.drawMode.ellipse",MODE_DRAW_POLYGON:"idle.drawMode.polygon"},initial:"idle",states:{idle:{id:"idle",initial:"selectMode",states:{selectMode:{initial:"mouseIsUp",states:{mouseIsUp:{on:{MT_DOWN:{actions:["selectComponent","mouseDownInSelectModeAssign"],target:"mouseIsDown"},KEYDOWN_ARRAY:{actions:"mouseDownInSelectModeObjectMove"}}},mouseIsDown:{on:{MT_UP:"mouseIsUp",MT_MOVE:{actions:"mouseDownInSelectModeObjectMove"}}}},on:{KEYDOWN_ESC:{actions:["unselectAll",fe("mouseDownInSelectModeUnassign")]},KEYDOWN_DEL:{actions:["deleteComponent",fe("mouseDownInSelectModeUnassign")]},mouseDownInSelectModeUnassign:{actions:"mouseDownInSelectModeUnassign"}},entry:"selectModeEntry",exit:["unselectAll",fe("mouseDownInSelectModeUnassign")]},drawMode:{initial:void 0,states:fr,on:{KEYDOWN_ESC:"#idle.selectMode"}}}},drawing:{id:"drawing",initial:void 0,states:dr,exit:lr([{cond:"unfinishedIsValid",actions:["unselectAll","validComponentFinished"]},{actions:"discardUnfinished"}])}}},{actions:{createRectangle:mt({unfinishedComponent:(t,e)=>t._editor.createRectangle({x:e.offsetX,y:e.offsetY})}),createCircle:mt({unfinishedComponent:(t,e)=>t._editor.createCircle({x:e.offsetX,y:e.offsetY})}),createEllipse:mt({unfinishedComponent:(t,e)=>t._editor.createEllipse({x:e.offsetX,y:e.offsetY})}),createPolygon:mt({unfinishedComponent:(t,e)=>t._editor.createPolygon({points:{x:e.offsetX,y:e.offsetY}})}),discardUnfinished:(t,e)=>{t._editor.unregisterComponent(t.unfinishedComponent)},resizeUnfinished:(t,e)=>{t.unfinishedComponent.resize(e.offsetX,e.offsetY)},selectUnfinished:(t,e)=>{t._editor.selectComponent(t.unfinishedComponent)},validComponentFinished:(t,e)=>{const r=t.unfinishedComponent;t._editor.componentDrawnHandler&&t._editor.componentDrawnHandler(r,r.element.id)},addPoint:(t,e)=>{t.unfinishedComponent.addPoint(e.offsetX,e.offsetY),t._editor.selectComponent(t.unfinishedComponent)},moveLastPoint:(t,e)=>{t.unfinishedComponent.moveLastPoint(e.offsetX,e.offsetY)},mouseDownInSelectModeAssign:mt({mouseDownInSelectModeObject:(t,e)=>e.component}),mouseDownInSelectModeUnassign:mt({mouseDownInSelectModeObject:null}),mouseDownInSelectModeObjectMove:(t,e)=>{const r=t.mouseDownInSelectModeObject;r&&r.move&&r.move(e.movementX,e.movementY)},selectComponent:(t,e)=>{t._editor.selectComponent(e.component)},deleteComponent:(t,e)=>{const r=t.mouseDownInSelectModeObject;r&&t._editor.unregisterComponent(r)},unselectAll:(t,e)=>{t._editor.selectComponent(null)},selectModeEntry:(t,e)=>{t._editor.mode="select",t._editor.selectModeHandler&&t._editor.selectModeHandler()}},guards:{isHandle:(t,e)=>e.component instanceof X,unfinishedIsValid:(t,e)=>t.unfinishedComponent.isValid()}}),pr=n=>qe(vr(n)),de=(n,t,e)=>{const r={defineProperty(i,s,o){return Object.is(o.value,i[s])||(typeof t=="function"?t.call(e||this,s,o.value,i[s],n):t[s].call(e||this,o.value,i[s],n)),Reflect.defineProperty(i,s,o)}};return new Proxy(n,r)};function Ze(n,t,e){return new X(n,t,(r,i)=>{e.x+=r,e.y+=i},this.isFrozen)}class yr{constructor(t,e){this.includeAttributes=["fill","stroke","opacity","stroke-width"],this.editorOwner=t,this.element=q.createElementNS(rt,"polygon"),this.points=[],this.includeAttributes=["fill","stroke","opacity","stroke-width"],e&&[e].flat().forEach(r=>this.addPoint(r.x,r.y)),this.isSelected=!1,this.isFrozen=!1}freeze(t){return this.isFrozen=t!==void 0?!!t:!0,this.getHandles().forEach(e=>e.freeze(t)),this}updateElementPoints(){return this.element.setAttribute("points",this.points.map(t=>`${t.x},${t.y}`).join(" ")),this}addPoint(t,e){const r={x:t,y:e},i=de(r,(s,o,u,a)=>{var h,c;s!=="handle"&&(this._logWarnOnOpOnFrozen("Point moved on"),this.updateElementPoints(),(c=(h=a.handle)==null?void 0:h["setAttr"+s.toUpperCase()])==null||c.call(h,o))});return r.handle=Ze.call(this,t,e,i),this.editorOwner.registerComponentHandle(r.handle),this.points.push(i),this.updateElementPoints(),this}moveLastPoint(t,e){const r=this.points[this.points.length-1];return[r.x,r.y]=[t,e],this}move(t,e){return this.points.forEach(r=>{r.x+=t,r.y+=e}),this}isValid(){return this.points.length>=3}setHandlesVisibility(t){return this.points.forEach(e=>{var r;if(!e.handle){const i=Ze.call(this,e.x,e.y,e);e.handle=i,(r=this.editorOwner)==null||r.registerComponentHandle(i)}e.handle.setVisible(t)}),this}getCenterCoords(){return this.points.reduce((t,e)=>(t.x+=e.x/this.points.length,t.y+=e.y/this.points.length,t),{x:0,y:0})}scale(t){return this.points.forEach((e,r)=>{e.x=Number((e.x*t).toFixed(2)),e.y=Number((e.y*t).toFixed(2))}),this.updateElementPoints(),this}setIsSelected(t){return this._logWarnOnOpOnFrozen("Select/unselect performed on"),this.isSelected=t=t!==void 0?!!t:!0,this.setHandlesVisibility(t),this.style&&W(this.element,t?this.style.componentSelect.on:this.style.componentSelect.off),this}getHandles(){return this.points.map(t=>t.handle)}clearHandles(){this.points.forEach(t=>{var e;(e=this.editorOwner)==null||e.unregisterComponent(t.handle),t.handle=null})}setStyle(t){return this.style=t,W(this.element,t.component),W(this.element,t.componentHover.off),W(this.element,t.componentSelect.off),Qt(this.element,t.componentHover.off,t.componentHover.on),this}setDataAttributes(t){for(let e in t)this.element.setAttribute(e,String(t[e]));return this}export(){const t={points:this.points.map(e=>{var r,i;return{x:e.x/(((r=this.editorOwner)==null?void 0:r.scale)||1),y:e.y/(((i=this.editorOwner)==null?void 0:i.scale)||1)}})};for(let e of this.element.attributes)(e.name in this.includeAttributes||ye.test(e.name))&&(t[e.name]=e.value);return t}_logWarnOnOpOnFrozen(t){this.isFrozen&&console.warn(`${t} frozen ${this.element.tagName} with id ${this.element.id}`)}}function tn(){const{x:n,y:t,width:e,height:r}=this.dim;this.handles=[new X(n,t,(i,s)=>{this.dim.x+=i,this.dim.width-=i,this.dim.y+=s,this.dim.height-=s},this.isFrozen),new X(n,t+r,(i,s)=>{this.dim.x+=i,this.dim.width-=i,this.dim.height+=s},this.isFrozen),new X(n+e,t,(i,s)=>{this.dim.width+=i,this.dim.y+=s,this.dim.height-=s},this.isFrozen),new X(n+e,t+r,(i,s)=>{this.dim.width+=i,this.dim.height+=s},this.isFrozen)],this.handles.forEach(i=>{var s;(s=this.editorOwner)==null||s.registerComponentHandle(i)})}class ve{constructor(t,e){this.editorOwner=null,this.includeAttributes=["fill","stroke","opacity","stroke-width"],this.dim={x:0,height:0,width:0,y:0},this.handles=[],this.isSelected=!1,this.isFrozen=!1,this.propChangeListener=e,this.svgElementName=t,this.element=q.createElementNS(rt,this.svgElementName)}add(t,e,r,i=0,s=0){this.editorOwner=t,this.dim=de({x:e,y:r,width:0,height:0},{x:(o,u,a)=>{this._logWarnOnOpOnFrozen("Dimension property x changed on"),this.propChangeListener.x.call(this,o,u,a),this.handles.length&&(this.handles[0].setAttrX(o),this.handles[1].setAttrX(o),this.handles[2].setAttrX(o+a.width),this.handles[3].setAttrX(o+a.width))},y:(o,u,a)=>{this._logWarnOnOpOnFrozen("Dimension property y changed on"),this.propChangeListener.y.call(this,o,u,a),this.handles.length&&(this.handles[0].setAttrY(o),this.handles[1].setAttrY(o+a.height),this.handles[2].setAttrY(o),this.handles[3].setAttrY(o+a.height))},width:(o,u,a)=>{this._logWarnOnOpOnFrozen("Dimension property width changed on"),this.propChangeListener.width.call(this,o,u,a),this.handles.length&&(this.handles[2].setAttrX(a.x+o),this.handles[3].setAttrX(a.x+o))},height:(o,u,a)=>{this._logWarnOnOpOnFrozen("Dimension property height changed on"),this.propChangeListener.height.call(this,o,u,a),this.handles.length&&(this.handles[1].setAttrY(a.y+o),this.handles[3].setAttrY(a.y+o))}},this),tn.call(this),[this.dim.width,this.dim.height]=[i,s],this.isSelected=!1,this.isFrozen=!1}freeze(t){return this.isFrozen=t!==void 0?!!t:!0,this.handles.forEach(e=>e.freeze(t)),this}resize(t,e){return this.dim.width=t-this.dim.x,this.dim.height=e-this.dim.y,this}move(t,e){return this.dim.x+=t,this.dim.y+=e,this}isValid(){return this.dim.width&&this.dim.height}setHandlesVisibility(t){var e,r;return t&&!((e=this.handles)!=null&&e.length)&&tn.call(this),(r=this.handles)==null||r.forEach(i=>i==null?void 0:i.setVisible(t)),this}setIsSelected(t){return this._logWarnOnOpOnFrozen("Select/unselect performed on"),this.isSelected=t=t!==void 0?!!t:!0,this.setHandlesVisibility(t),this.style&&W(this.element,t?this.style.componentSelect.on:this.style.componentSelect.off),this}getHandles(){return this.handles}getCenterCoords(){return{x:this.dim.x+this.dim.width/2,y:this.dim.y+this.dim.height/2}}clearHandles(){this.handles.forEach(t=>{var e;return(e=this.editorOwner)==null?void 0:e.unregisterComponent(t)}),this.handles=[]}scale(t){return this.dim.width=Number((this.dim.width*t).toFixed(2)),this.dim.height=Number((this.dim.height*t).toFixed(2)),this.dim.x=Number((this.dim.x*t).toFixed(2)),this.dim.y=Number((this.dim.y*t).toFixed(2)),this}setStyle(t){return this.style=t,W(this.element,t.component),W(this.element,t.componentHover.off),W(this.element,t.componentSelect.off),Qt(this.element,t.componentHover.off,t.componentHover.on),this}setDataAttributes(t){var e;for(let r in t)(e=this.element)==null||e.setAttribute(r,String(t[r]));return this}export(){var e,r,i,s,o;const t={width:this.dim.width/(((e=this.editorOwner)==null?void 0:e.scale)||1),height:this.dim.height/(((r=this.editorOwner)==null?void 0:r.scale)||1),x:this.dim.x/(((i=this.editorOwner)==null?void 0:i.scale)||1),y:this.dim.y/(((s=this.editorOwner)==null?void 0:s.scale)||1)};for(let u of(o=this.element)==null?void 0:o.attributes)(u.name in this.includeAttributes||ye.test(u.name))&&(t[u.name]=u.value);return t}_logWarnOnOpOnFrozen(t){var e,r;this.isFrozen&&console.warn(`${t} frozen ${(e=this.element)==null?void 0:e.tagName} with id ${(r=this.element)==null?void 0:r.id}`)}}class gr extends ve{constructor(t,e,r,i,s){super("rect",{x:(o,u,a)=>{this.element.setAttribute("x",String(a.width<0?o+a.width:o))},y:(o,u,a)=>{this.element.setAttribute("y",String(a.height<0?o+a.height:o))},width:(o,u,a)=>{this.element.setAttribute("width",String(Math.abs(o))),this.element.setAttribute("x",String(o<0?a.x+o:a.x))},height:(o,u,a)=>{this.element.setAttribute("height",String(Math.abs(o))),this.element.setAttribute("y",String(o<0?a.y+o:a.y))}}),this.add(t,e,r,i,s)}}class mr extends ve{constructor(t,e,r,i,s){super("circle",{x:(o,u,a)=>{var h;(h=this==null?void 0:this.element)==null||h.setAttribute("cx",String(o+a.width/2))},y:(o,u,a)=>{var h;(h=this==null?void 0:this.element)==null||h.setAttribute("cy",String(o+a.height/2))},width:(o,u,a)=>{var h,c;(h=this==null?void 0:this.element)==null||h.setAttribute("r",String(Math.min(Math.abs(o),Math.abs(a.height))/2)),(c=this==null?void 0:this.element)==null||c.setAttribute("cx",String(a.x+o/2))},height:(o,u,a)=>{var h,c;(h=this==null?void 0:this.element)==null||h.setAttribute("r",String(Math.min(Math.abs(o),Math.abs(a.width))/2)),(c=this==null?void 0:this.element)==null||c.setAttribute("cy",String(a.y+o/2))}}),this.add(t,e,r,i,s)}}class wr extends ve{constructor(t,e,r,i,s){super("ellipse",{x:(o,u,a)=>{this.element.setAttribute("cx",String(o+a.width/2))},y:(o,u,a)=>{this.element.setAttribute("cy",String(o+a.height/2))},width:(o,u,a)=>{this.element.setAttribute("rx",String(Math.abs(o)/2)),this.element.setAttribute("cx",String(a.x+o/2))},height:(o,u,a)=>{this.element.setAttribute("ry",String(Math.abs(o)/2)),this.element.setAttribute("cy",String(a.y+o/2))}}),this.add(t,e,r,i,s)}}var wt=(n=>(n[n.LMB=1]="LMB",n[n.RMB=2]="RMB",n[n.MMB=4]="MMB",n))(wt||{});const Sr=new RegExp(/[A-Z]+/g),en=n=>{const t=n.matchAll(Sr);for(let e of t)e.index&&(n=n.replace(e[0],"-"+e[0].toLowerCase()));return n};class nn{constructor(t,e={},r){if(this.scale=1,this.imageSizes={width:0,height:0},this.mouseButtons=[wt.LMB,wt.MMB,wt.RMB],[this.width=1200,this.height=600,this.componentDrawnHandler,this.selectModeHandler,this.clickHandler,this.selectHandler,this.idGenerator,this.deleteHandler]=[e.width,e.height,e.componentDrawnHandler,e.selectModeHandler,e.clickHandler,e.selectHandler,e.idGenerator,e.deleteHandler],e.mouseButtons&&(this.mouseButtons=e.mouseButtons),this.style=qt(pn(),r),this.fsmService=pr(this).start(),this.svg=t,typeof t=="string"){if(this.svg=q.getElementById(t),!this.svg){this.svg=q.createElementNS(rt,"svg"),this.svg.setAttribute("version","1.1"),this.svg.setAttribute("id",t),this.svg.setAttribute("width",this.width+"px"),this.svg.setAttribute("height",this.height+"px"),this.svg.setAttribute("viewBox",`0, 0, ${this.width} ${this.height}`),this.svg.setAttribute("preserveAspectRatio","xMinYMin");const i=this.svg;window.addEventListener("load",function(){q.body.appendChild(i)},{once:!0})}}else t&&t.tagName==="svg"&&(this.svg=t);if(!this.svg)throw new Error("No SVG element provided");this.cgroup=q.createElementNS(rt,"g"),this.hgroup=q.createElementNS(rt,"g"),this.svg.appendChild(this.cgroup),this.svg.appendChild(this.hgroup),this._cacheElementMapping=de({},(i,s,o)=>{s?s instanceof X?this.hgroup.appendChild(s.element):this.cgroup.appendChild(s.element):o instanceof X?this.hgroup.removeChild(o.element):o&&(this.cgroup.removeChild(o.element),o.getHandles().forEach(u=>{this.unregisterComponent(u)}))}),this._idCounter=1,this._handleIdCounter=1}loadImage(t,e,r){var i;return this.image=q.createElementNS(rt,"image"),this.image.setAttributeNS(un,"href",t),this.imageSizes.width=e,this.imageSizes.height=r,e&&this.image.setAttribute("width",String(e)),r&&this.image.setAttribute("height",String(r)),(i=this.svg)==null||i.prepend(this.image),this}setStyle(t){return this.style=qt(this.style,t),this}setScale(t){var r,i;const e=t/this.scale;for(const s in this._cacheElementMapping)(i=(r=this._cacheElementMapping[s])==null?void 0:r.scale)==null||i.call(r,e);if(this.image&&this.image.getAttribute("width")&&this.image.getAttribute("height")){const{width:s,height:o}=this.imageSizes;s&&this.image.setAttribute("width",(s*t).toFixed(2)),o&&this.image.setAttribute("height",(o*t).toFixed(2))}this.scale=t}setEditorMode(t){switch(this.mode=t,t){case"circle":{this.fsmService.send("MODE_DRAW_CIRCLE");break}case"ellipse":{this.fsmService.send("MODE_DRAW_ELLIPSE");break}case"polygon":{this.fsmService.send("MODE_DRAW_POLYGON");break}case"rect":{this.fsmService.send("MODE_DRAW_RECT");break}case"select":{this.fsmService.send("MODE_SELECT");break}}}selectComponent(t){let e;return typeof t=="string"?e=this.getComponentById(t):e=t,(!e||e.setIsSelected)&&Object.values(this._cacheElementMapping).forEach(r=>{var i;r===t&&((i=this.selectHandler)==null||i.call(this,r.element.id,r),r.setIsSelected&&r.setIsSelected(!0)),r!==t&&!r.isFrozen&&r.setIsSelected&&(r.setIsSelected(!1),r.getHandles().forEach(s=>{this.unregisterComponent(s)}),r.clearHandles())}),e}removeComponent(t){return typeof t=="string"&&(t=this.getComponentById(t)),this.unregisterComponent(t),t}on(t,e){return Z(this.svg,t,e),this}off(t,e){return hn(this.svg,t,e),this}getComponentById(t){return this._cacheElementMapping&&this._cacheElementMapping[t]}import(t,e){const r=typeof t=="string"?JSON.parse(t):t;return this._idCounter=r.idCounter,r.components.map(i=>{var u,a;const s=e?e(i.id):i.id,o={};for(let h in i.data)o[en(h)]=i.data[h];switch((a=(u=i.data)==null?void 0:u.entries)==null||a.call(u).map(([h,c])=>({[en(h)]:c})),i.type){case"rect":return this.createRectangle(o,s);case"circle":return this.createCircle(o,s);case"ellipse":return this.createEllipse(o,s);case"polygon":return this.createPolygon(o,s);default:return console.error("Unknown type",i.type),null}}).filter(i=>{var s;return(s=i==null?void 0:i.clearHandles)==null||s.call(i),!!i})}export(t){return{idCounter:this._idCounter,components:Object.entries(this._cacheElementMapping).filter(([r,i])=>!(i instanceof X)).map(([r,i])=>({id:r,type:i.element.tagName,data:i.export()}))}}createRectangle(t,e){const{x:r,y:i,width:s,height:o,...u}=t;return this.registerComponent(new gr(this,r,i,s,o).setStyle(this.style).setDataAttributes(u),e)}createCircle(t,e){const{x:r,y:i,width:s,height:o,...u}=t;return this.registerComponent(new mr(this,r,i,s,o).setStyle(this.style).setDataAttributes(u),e)}createEllipse(t,e){const{x:r,y:i,width:s,height:o,...u}=t;return this.registerComponent(new wr(this,r,i,s,o).setStyle(this.style).setDataAttributes(u),e)}createPolygon(t,e){const{points:r,...i}=t;return this.registerComponent(new yr(this,r).setStyle(this.style).setDataAttributes(i),e)}registerComponent(t,e){var r;return t instanceof X?e="handle_"+this._handleIdCounter++:e=e||((r=this.idGenerator)==null?void 0:r.call(this))||t.element.tagName+"_"+this._idCounter++,this._cacheElementMapping[e]=t,t.element.id=e,t}registerComponentHandle(t){return this.registerComponent(t.setStyle(this.style.handle,this.style.handleHover))}unregisterComponent(t){var e,r,i;t=typeof t=="string"?this.selectComponent(t):t,t&&(!(t instanceof X)&&((e=t.isValid)!=null&&e.call(t))&&((i=this.deleteHandler)==null||i.call(this,(r=t==null?void 0:t.element)==null?void 0:r.id,t)),t._logWarnOnOpOnFrozen&&t._logWarnOnOpOnFrozen("Deleting"),this._cacheElementMapping[t.element.id]=null,delete this._cacheElementMapping[t.element.id])}}const br=n=>{let t;return Z(n.svg,"mousedown touchstart",e=>{var u;if(e.preventDefault(),e instanceof MouseEvent&&!(e.button in n.mouseButtons))return;const r=n.getComponentById(e.target.id),i=r&&r.isFrozen?null:r,s=(u=n.svg)==null?void 0:u.getBoundingClientRect(),o=e.targetTouches&&e.targetTouches[0];n.fsmService.send({type:"MT_DOWN",component:i,offsetX:e.offsetX!==void 0?e.offsetX:o&&o.clientX-s.x,offsetY:e.offsetY!==void 0?e.offsetY:o&&o.clientY-s.y}),t=o}),Z(n.svg,"mouseup touchend mouseleave touchleave",e=>{e.preventDefault(),n.fsmService.send({type:"MT_UP"}),t=null}),Z(n.svg,"mousemove touchmove",e=>{var s;const r=(s=n.svg)==null?void 0:s.getBoundingClientRect(),i=e.targetTouches&&e.targetTouches[0];n.fsmService.send({type:"MT_MOVE",offsetX:e.offsetX!==void 0?e.offsetX:i&&i.clientX-r.x,offsetY:e.offsetY!==void 0?e.offsetY:i&&i.clientY-r.y,movementX:e.movementX!==void 0?e.movementX:t?i.clientX-t.clientX:0,movementY:e.movementY!==void 0?e.movementY:t?i.clientY-t.clientY:0}),t=i}),Z(ut.window,"keydown",e=>{switch(e.key){case"Escape":n.fsmService.send("KEYDOWN_ESC");break;case"Enter":n.fsmService.send("KEYDOWN_ESC");case"Delete":n.fsmService.send("KEYDOWN_DEL");break;case"ArrowUp":e.preventDefault(),n.fsmService.send({type:"KEYDOWN_ARRAY",movementX:0,movementY:-1});break;case"ArrowDown":e.preventDefault(),n.fsmService.send({type:"KEYDOWN_ARRAY",movementX:0,movementY:1});break;case"ArrowLeft":e.preventDefault(),n.fsmService.send({type:"KEYDOWN_ARRAY",movementX:-1,movementY:0});break;case"ArrowRight":e.preventDefault(),n.fsmService.send({type:"KEYDOWN_ARRAY",movementX:1,movementY:0});break}}),n},xr=n=>(Z(n.cgroup,"click touchstart",t=>{var e;t.preventDefault(),n.clickHandler&&n.clickHandler(t,t.target.id,(e=n.selectComponent(t.target.id))==null?void 0:e.getCenterCoords())}),n),qt=(n,...t)=>{if(!t.length||!t[0])return n;const e=t.shift();return Object.entries(e).forEach(([r,i])=>{Object.getPrototypeOf(i)===Object.prototype?qt(n[r],i):n[r]=i}),qt(n,...t)},rn=n=>function(e,r={},i){return n?xr(new nn(e,r,i)):br(new nn(e,r,i))},sn=rn(!1),on=rn(!0),Er={editor:sn,view:on,MouseButtons:wt};G.MouseButtons=wt,G.default=Er,G.editor=sn,G.view=on,Object.defineProperties(G,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
